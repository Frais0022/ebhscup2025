<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>EBHS Interhouse Football — Editable Scores & Auto Scorer Tables</title>
<style>
<h1>EBHS Interhouse Football — Editable Scores (Model A)</h1>

<div class="card">
  <div class="flex" style="justify-content:space-between;align-items:center">
    <div class="small muted">Shareable link: <code id="shareLink"></code></div>
    <div id="countdown" class="small muted"></div>
  </div>
</div>

<div class="card">
  <h3>Team Slots — Representatives Claim Here</h3>
  <div id="slotsRow" class="flex"></div>
  <div style="margin-top:10px"><button id="generateBtn" onclick="generateFixtures()" disabled>Generate Semi-Final Fixtures</button></div>
</div>

<div class="card" id="fixturesCard" style="display:none">
  <h3>Semi-Finals</h3>
  <div id="fixtures"></div>
</div>

<div class="card" id="finalCard" style="display:none">
  <h3>Final</h3>
  <div id="finals"></div>
</div>

<div class="card">
  <h3>Per-match Leaderboards</h3>
  <div id="matchLeaderboards"></div>
</div>

<div class="card">
  <h3>Competition Scorers Ranking</h3>
  <div id="globalLeaderboardTable"></div>
</div>

<div class="card">
  <h3>Competition Scorers Chat (auto from scorers)</h3>
  <div id="globalChat"></div>
</div>

<div class="card small">
  <label>Admin actions (password required)</label>
  <input id="adminPass" type="password" placeholder="Admin password (REMI2025)" />
  <div style="margin-top:8px;display:flex;gap:8px">
    <button onclick="resetEverything()" class="secondary">Reset All Data</button>
    <button onclick="forceFetch()">Sync Now</button>
  </div>
  <div id="status"></div>
  <div id="error"></div>
</div>

<script>
/* ====== CONFIG ====== */
const BIN_ID = "6935e85143b1c97be9de3eb2"; // Your JSONBin ID
const API_KEY = "$2a$10$ez2mNhQs2BylwsUGJgfaceuUHDJnBUnWu6mwdgavcko3ZQTMXyKlG"; // Your JSONBin API key
const ADMIN_PASSWORD = "REMI2025";
const POLL_MS = 5000;
const COMP_DATE = new Date("December 8, 2025 08:30:00").getTime();
/* ================== */

let remoteData = null;
let pushing = false;

/* Helpers */
function setStatus(msg, isError=false){
  document.getElementById("status").textContent = isError ? "" : msg;
  document.getElementById("error").textContent = isError ? msg : "";
}
function shareLinkUpdate(){
  const u = new URL(location.href);
  if(!u.searchParams.get('comp')) u.searchParams.set('comp','EBHS2025');
  history.replaceState({},'',u.toString());
  document.getElementById('shareLink').textContent = u.toString();
}
function escapeHtml(s){ if(s===undefined||s===null) return ""; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

/* Countdown */
function updateCountdown(){
  const el = document.getElementById('countdown');
  const diff = COMP_DATE - Date.now();
  if(diff <= 0){ el.textContent = "Competition is LIVE!"; return; }
  const d = Math.floor(diff/(1000*60*60*24));
  const h = Math.floor((diff%(1000*60*60*24))/(1000*60*60));
  const m = Math.floor((diff%(1000*60*60))/(1000*60));
  const s = Math.floor((diff%(1000*60))/1000);
  el.textContent = `Starts: ${d}d ${h}h ${m}m ${s}s`;
}
setInterval(updateCountdown,1000);
updateCountdown();
shareLinkUpdate();

/* ====== JSONBin fetch/push ====== */
async function fetchRemote(){
  try{
    const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
      headers: { "X-Master-Key": API_KEY }
    });
    if(!res.ok) throw new Error("Failed to fetch JSONBin data");
    const data = await res.json();
    remoteData = normalize(data.record);
    saveLocal(remoteData);
    renderAll();
    setStatus(`Synced: ${new Date().toLocaleTimeString()}`);
  }catch(err){
    console.error(err);
    setStatus("Fetch failed from JSONBin", true);
  }
}
async function pushUpdate(payload){
  if(pushing) return;
  pushing = true;
  setStatus("Pushing update...");
  try{
    const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
      method:"PUT",
      headers:{
        "Content-Type":"application/json",
        "X-Master-Key": API_KEY
      },
      body: JSON.stringify(payload)
    });
    if(!res.ok) throw new Error("Push failed " + res.status);
    remoteData = normalize(payload);
    saveLocal(remoteData);
    renderAll();
    setStatus("Update pushed: " + new Date().toLocaleTimeString());
  }catch(err){
    console.error(err);
    setStatus("Push failed: "+err.message,true);
  } finally{ pushing=false; }
}

/* Local storage fallback */
function saveLocal(d){ localStorage.setItem("comp_shared", JSON.stringify(d)); }
function loadLocal(){ try{ return normalize(JSON.parse(localStorage.getItem("comp_shared")||"null")); }catch(e){ return normalize(null);} }
function normalize(d){
  if(!d) d = {};
  d.teams = Array.isArray(d.teams) && d.teams.length===4 ? d.teams : [{name:"",logo:""},{name:"",logo:""},{name:"",logo:""},{name:"",logo:""}];
  d.fixtures = d.fixtures || { semi:null, final:null, winners:["",""], scores:[[0,0],[0,0]], chat:[[],[]], finalScore:[0,0], finalChat:[] };
  d.fixtures.chat = d.fixtures.chat || [[],[]];
  d.fixtures.finalChat = d.fixtures.finalChat || [];
  return d;
}

/* Start polling */
fetchRemote();
setInterval(fetchRemote, POLL_MS);
const cached = loadLocal();
if(cached){ remoteData = cached; renderAll(); }

/* ====== Rest of your UI logic, claimSlot, generateFixtures, saveMatch/saveFinal, render functions ====== */
/* You can keep all your previous code from your HTML here, just replace pushUpdate & fetchRemote logic as above */
</script>
</body>
</html>￼EnterYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>EBHS Interhouse Football — Editable Scores & Auto Scorer Tables</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:linear-gradient(135deg,#0ea5e9,#60a5fa);color:#042;padding:18px;margin:0;}
  h1{color:#fff;margin:0 0 12px 0;text-align:center}
  .card{background:#fff;border-radius:10px;padding:12px;max-width:980px;margin:12px auto;box-shadow:0 8px 24px rgba(2,6,23,0.12)}
  .flex{display:flex;gap:10px;flex-wrap:wrap}
  input,button,textarea,select{font-size:14px;padding:8px;border-radius:8px;border:1px solid #cbd5e1}
  button{background:#0369a1;color:white;border:none;cursor:pointer}
  button.secondary{background:#475569}
  button:disabled{opacity:0.55;cursor:not-allowed}
  .slot{width:220px;padding:10px}
  .logo{width:48px;height:48px;border-radius:8px;object-fit:cover;margin-left:8px}
  table{width:100%;border-collapse:collapse;margin-top:8px}
  th,td{border:1px solid #e6eef8;padding:6px;text-align:center}
  th{background:#0369a1;color:#fff}
  .muted{color:#475569;font-size:13px}
  .small{font-size:13px}
  #status{font-size:13px;margin-top:8px;color:#065f46}
  #error{color:#b91c1c}
  label{display:block;margin-top:8px;font-weight:600}
  .right{float:right}
</style>
</head>
<body>
<h1>EBHS Interhouse Football — Editable Scores (Model A)</h1>

<div class="card">
  <div class="flex" style="justify-content:space-between;align-items:center">
    <div class="small muted">Shareable link: <code id="shareLink"></code></div>
    <div id="countdown" class="small muted"></div>
  </div>
</div>

<div class="card">
  <h3>Team Slots — Representatives Claim Here</h3>
  <div id="slotsRow" class="flex"></div>
  <div style="margin-top:10px"><button id="generateBtn" onclick="generateFixtures()" disabled>Generate Semi-Final Fixtures</button></div>
</div>

<div class="card" id="fixturesCard" style="display:none">
  <h3>Semi-Finals</h3>
  <div id="fixtures"></div>
</div>

<div class="card" id="finalCard" style="display:none">
  <h3>Final</h3>
  <div id="finals"></div>
</div>

<div class="card">
  <h3>Per-match Leaderboards</h3>
  <div id="matchLeaderboards"></div>
</div>

<div class="card">
  <h3>Competition Scorers Ranking</h3>
  <div id="globalLeaderboardTable"></div>
</div>

<div class="card">
  <h3>Competition Scorers Chat (auto from scorers)</h3>
  <div id="globalChat"></div>
</div>

<div class="card small">
  <label>Admin actions (password required)</label>
  <input id="adminPass" type="password" placeholder="Admin password (REMI2025)" />
  <div style="margin-top:8px;display:flex;gap:8px">
    <button onclick="resetEverything()" class="secondary">Reset All Data</button>
    <button onclick="forceFetch()">Sync Now</button>
  </div>
  <div id="status"></div>
  <div id="error"></div>
</div>

