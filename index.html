<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ebhs Football Competition</title>
<style>
body {font-family: Arial; background: linear-gradient(to right,#6dd5ed,#2193b0); padding:20px; text-align:center; color:#fff;}
h1 {font-size:24px;margin-bottom:15px;}
.slot-box,.fixture-box,.chat-box {background: rgba(255,255,255,0.9);color:#000;padding:15px;border-radius:12px;margin:12px auto;width:90%;max-width:450px;box-shadow:0 0 15px rgba(0,0,0,0.2);}
input,button,select,textarea {width:90%;padding:10px;border-radius:6px;border:1px solid #ccc;margin-top:10px;font-size:16px;}
button {background:#007bff;color:white;border:none;cursor:pointer;}
button:disabled{background:gray;}
img.logo{max-width:50px;max-height:50px;border-radius:50%;margin-left:10px;vertical-align:middle;}
#fixtures,#finals{margin-top:20px;font-size:18px;font-weight:bold;}
.match{display:flex;justify-content:space-between;align-items:center;margin:10px 0;flex-wrap:wrap;}
.match div{display:flex;align-items:center;margin:5px;}
#countdown{font-size:20px;margin:15px 0;}
textarea{resize:none;height:60px;}
</style>
</head>
<body>

<h1>REMI OYEBADE INTERHOUSE FOOTBALL COMPETITION 2025</h1>
<div id="countdown"></div>
<div id="slots"></div>
<button id="generateBtn" onclick="generateFixtures()" disabled>Generate Semi-Final Fixtures</button>
<div id="fixtures"></div>
<div id="finals"></div>

<!-- Global Competition Chat -->
<div id="competitionChat" class="slot-box">
  <h3>Competition Scorers Chat</h3>
  <div class="chat-box" id="globalChat"></div>
</div>

<input type="password" id="adminPass" placeholder="Enter Admin Password for Reset">
<button onclick="resetSlots()">Reset All Slots (Admin Only)</button>
<p>Share this link with teams: <span id="shareLink"></span></p>

<script>
// CONFIG
const adminPassword="REMI2025";
const competitionDate=new Date("December 8, 2025 08:30:00").getTime();

// ---- SHAREABLE ID ----
const urlParams=new URLSearchParams(window.location.search);
let compID=urlParams.get("comp")||"EBHS2025"; 
document.getElementById("shareLink").textContent=window.location.origin+window.location.pathname+"?comp="+compID;

// ---- COUNTDOWN ----
function updateCountdown(){
    let now=new Date().getTime();
    let distance=competitionDate-now;
    if(distance<0){document.getElementById("countdown").textContent="Competition is LIVE!"; clearInterval(countdownInterval); return;}
    let d=Math.floor(distance/(1000*60*60*24)), h=Math.floor((distance%(1000*60*60*24))/(1000*60*60)), m=Math.floor((distance%(1000*60*60))/(1000*60)), s=Math.floor((distance%(1000*60))/1000);
    document.getElementById("countdown").textContent=`Competition Starts in: ${d}d ${h}h ${m}m ${s}s`;
}
let countdownInterval=setInterval(updateCountdown,1000);

// ---- STORAGE HELPERS ----
function getStorage(){return JSON.parse(localStorage.getItem("comp_"+compID)||"{}");}
function setStorage(data){localStorage.setItem("comp_"+compID,JSON.stringify(data));}

// ---- INIT ----
if(!getStorage().teams)setStorage({teams:[{name:"",logo:""},{name:"",logo:""},{name:"",logo:""},{name:"",logo:""}],fixtures:{semi:null,final:null,winners:["",""],scores:[[0,0],[0,0]],chat:[[],[]],finalScore:[0,0],finalChat:[]}});

// ---- LOAD SLOTS ----
function loadSlots(){
    let slotsDiv=document.getElementById("slots");
    let data=getStorage();
    let teams=data.teams;
    slotsDiv.innerHTML="";
    teams.forEach((team,index)=>{
        if(team.name===""){
            slotsDiv.innerHTML+=`<div class="slot-box">
                <h3>Slot ${index+1}</h3>
                <input id="input${index}" placeholder="Enter team/house name">
                <input type="file" id="logo${index}" accept="image/*">
                <button onclick="claimSlot(${index})">Claim Slot</button>
            </div>`;
        }else{
            let logoHTML=team.logo?`<img class="logo" src="${team.logo}">`:"";
            slotsDiv.innerHTML+=`<div class="slot-box">
                <h3>Slot ${index+1}</h3>
                <p><strong>${team.name}</strong> ${logoHTML}</p>
                <button disabled>Slot Taken</button>
            </div>`;
        }
    });
    checkReady();
}

// ---- CLAIM SLOT ----
function claimSlot(i){
    let name=document.getElementById("input"+i).value.trim();
    if(!name){alert("Team name cannot be empty."); return;}
    let fileInput=document.getElementById("logo"+i);
    let reader=new FileReader();
    reader.onload=function(e){
        let logoData=e.target.result;
        let data=getStorage();
        data.teams[i]={name:name,logo:logoData};
        setStorage(data);
        loadSlots();
    };
    if(fileInput.files[0]) reader.readAsDataURL(fileInput.files[0]);
    else {let data=getStorage(); data.teams[i]={name:name,logo:""}; setStorage(data); loadSlots();}
}

// ---- CHECK READY ----
function checkReady(){let data=getStorage(); document.getElementById("generateBtn").disabled=!data.teams.every(t=>t.name!=="");}

// ---- SHUFFLE & GENERATE FIXTURES ----
function shuffle(arr){for(let i=arr.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}return arr;}
function generateFixtures(){
    let data=getStorage();
    let shuffled=shuffle([...data.teams]);
    data.fixtures={semi:[{team1:shuffled[0],team2:shuffled[1]},{team1:shuffled[2],team2:shuffled[3]}],final:null,winners:["",""],scores:[[0,0],[0,0]],chat:[[],[]],finalScore:[0,0],finalChat:[]};
    setStorage(data); renderFixtures();
}

// ---- RENDER FIXTURES WITH WINNER HIGHLIGHT ----
function renderFixtures(){
    let data=getStorage();
    let fixturesDiv=document.getElementById("fixtures");
    let finalsDiv=document.getElementById("finals");
    let f=data.fixtures;

    if(f.semi){
        fixturesDiv.style.display="block";
        fixturesDiv.innerHTML="<p>SEMI-FINAL FIXTURES</p>";
        f.semi.forEach((match,idx)=>{
            let s0=f.scores[idx][0], s1=f.scores[idx][1];
            let t1Color="black", t2Color="black";
            if(s0>s1){ t1Color="green"; t2Color="red"; }
            else if(s1>s0){ t2Color="green"; t1Color="red"; }
            else if(s0===s1 && (s0+s1)>0){ t1Color=t2Color="orange"; }

            fixturesDiv.innerHTML+=`<div class="fixture-box match">
                <div><strong style="color:${t1Color}">${match.team1.name}</strong> ${match.team1.logo?`<img class="logo" src="${match.team1.logo}">`:""}</div>
                <div>vs</div>
                <div><strong style="color:${t2Color}">${match.team2.name}</strong> ${match.team2.logo?`<img class="logo" src="${match.team2.logo}">`:""}</div>
                <div>
                    Score: <input type="number" min="0" value="${s0}" onchange="updateScore(${idx},0,this.value)"> -
                           <input type="number" min="0" value="${s1}" onchange="updateScore(${idx},1,this.value)">
                </div>
                <div>
                    <strong>Scorers Chat:</strong>
                    <div class="chat-box" id="chat${idx}">${f.chat[idx].map(c=>`<p>${c}</p>`).join("")}</div>
                    <input id="msg${idx}" placeholder="Enter scorer message">
                    <button onclick="sendChat(${idx})">Send</button>
                </div>
            </div>`;
        });
    }else fixturesDiv.style.display="none";

    if(f.final){
        finalsDiv.style.display="block";
        let fs0=f.finalScore[0], fs1=f.finalScore[1];
        let ft1Color="black", ft2Color="black";
        if(fs0>fs1){ ft1Color="green"; ft2Color="red"; }
        else if(fs1>fs0){ ft2Color="green"; ft1Color="red"; }
        else if(fs0===fs1 && (fs0+fs1)>0){ ft1Color=ft2Color="orange"; }

        finalsDiv.innerHTML=`<p>FINAL MATCH</p>
            <div class="fixture-box match">
                <div><strong style="color:${ft1Color}">${f.final.team1.name}</strong> ${f.final.team1.logo?`<img class="logo" src="${f.final.team1.logo}">`:""}</div>
                <div>vs</div>
                <div><strong style="color:${ft2Color}">${f.final.team2.name}</strong> ${f.final.team2.logo?`<img class="logo" src="${f.final.team2.logo}">`:""}</div>
                <div>
                    Score: <input type="number" min="0" value="${fs0}" onchange="updateFinalScore(0,this.value)"> -
                           <input type="number" min="0" value="${fs1}" onchange="updateFinalScore(1,this.value)">
                </div>
                <div>
                    <strong>Scorers Chat:</strong>
                    <div class="chat-box" id="finalChat">${f.finalChat.map(c=>`<p>${c}</p>`).join("")}</div>
                    <input id="finalMsg" placeholder="Enter scorer message">
                    <button onclick="sendFinalChat()">Send</button>
                </div>
            </div>`;
    }else finalsDiv.style.display="none";

    // Update global competition chat
    updateGlobalChat();
}

// ---- SCORE UPDATES ----
function updateScore(matchIdx,teamIdx,val){
    let data=getStorage();
    data.fixtures.scores[matchIdx][teamIdx]=parseInt(val)||0;
    let s0=data.fixtures.scores[matchIdx][0], s1=data.fixtures.scores[matchIdx][1];
    if(s0>s1) data.fixtures.winners[matchIdx]=data.fixtures.semi[matchIdx].team1.name;
    else if(s1>s0) data.fixtures.winners[matchIdx]=data.fixtures.semi[matchIdx].team2.name;
    else data.fixtures.winners[matchIdx]="";
    if(data.fixtures.winners[0] && data.fixtures.winners[1]){
        let t1=data.fixtures.semi[0].team1.name===data.fixtures.winners[0]?data.fixtures.semi[0].team1:data.fixtures.semi[0].team2;
        let t2=data.fixtures.semi[1].team1.name===data.fixtures.winners[1]?data.fixtures.semi[1].team1:data.fixtures.semi[1].team2;
        data.fixtures.final={team1:t1,team2:t2};
    }else data.fixtures.final=null;
    setStorage(data); renderFixtures();
}

function updateFinalScore(teamIdx,val){
    let data=getStorage();
    data.fixtures.finalScore[teamIdx]=parseInt(val)||0;
    setStorage(data); renderFixtures();
}

// ---- CHAT ----
function sendChat(idx){
    let msg=document.getElementById("msg"+idx).value.trim();
    if(!msg) return;
    let data=getStorage();
    data.fixtures.chat[idx].push(msg);
    setStorage(data);
    document.getElementById("msg"+idx).value="";
    renderFixtures();
}

function sendFinalChat(){
    let msg=document.getElementById("finalMsg").value.trim();
    if(!msg) return;
    let data=getStorage();
    data.fixtures.finalChat.push(msg);
    setStorage(data);
    document.getElementById("finalMsg").value="";
    renderFixtures();
}

// ---- GLOBAL COMPETITION CHAT ----
function updateGlobalChat(){
    let data=getStorage();
    let globalDiv=document.getElementById("globalChat");
    let messages=[];

    data.fixtures.semi?.forEach((match,idx)=>{
        data.fixtures.chat[idx].forEach(msg=>{
            messages.push(`${match.team1.name} / ${match.team2.name} Scorer: ${msg}`);
        });
    });

    data.fixtures.finalChat.forEach(msg=>{
        let finalTeams=data.fixtures.final?`${data.fixtures.final.team1.name} / ${data.fixtures.final.team2.name}`:"Final";
        messages.push(`${finalTeams} Scorer: ${msg}`);
    });

    globalDiv.innerHTML=messages.map(m=>`<p>${m}</p>`).join("");
}

// ---- RESET ----
function resetSlots(){
    let pass=document.getElementById("adminPass").value;
    if(pass!==adminPassword){alert("Incorrect admin password!"); return;}
    setStorage({teams:[{name:"",logo:""},{name:"",logo:""},{name:"",logo:""},{name:"",logo:""}],fixtures:{semi:null,final:null,winners:["",""],scores:[[0,0],[0,0]],chat:[[],[]],finalScore:[0,0],finalChat:[]}})
    renderFixtures(); loadSlots();
}

// ---- INITIAL RENDER ----
loadSlots(); renderFixtures();
window.addEventListener('storage',()=>{loadSlots(); renderFixtures();});
</script>
</body>
    </html>
